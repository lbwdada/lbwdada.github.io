---
title: nacos作为配置中心的配置会和本地配置文件中的冲突吗
categories:
- java
- spring
tags:
- 学习记录
---



若配置了nacos作为配置中心则默认nacos的配置会优先于本地配置。
<!--  more  -->

## 配置nacos作为配置中心

> 在bootstrap.yml中写入以下配置即可指定nacos作为配置中心
>
> ```yml
> spring:
>   application:
>     name: nacos-config-client
>   cloud:
>     nacos:
>       discovery:
>         server-addr: localhost:8848 #Nacos服务注册中心地址
>       config:
>         server-addr: localhost:8848 #Nacos作为配置中心地址
>         file-extension: yaml #指定yaml格式的配置
> ```

## nacos中配置文件dataid的生成规则

> 在 Nacos Spring Cloud 中，`dataId` 的完整格式如下（详情可以参考官网 [https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html](https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html)）：

```java
${prefix}-${spring.profiles.active}.${file-extension}
```

	1. `prefix` 默认为 `spring.application.name` 的值，也可以通过配置项 `spring.cloud.nacos.config.prefix`来配置。
	2. `spring.profiles.active` 即为当前环境对应的 profile，注意：**当 `spring.profiles.active` 为空时，对应的连接符 `-` 也将不存在，dataId 的拼接格式变成 `${prefix}.${file-extension}`**（不能删除）
	3. `file-exetension` 为配置内容的数据格式，可以通过配置项 `spring.cloud.nacos.config.file-extension` 来配置。目前只支持 `properties` 和 `yaml` 类型。
	4. 通过 Spring Cloud 原生注解 `@RefreshScope` 实现配置自动更新：
	5. 所以根据官方给出的规则我们最终需要在Nacos配置中心添加的配置文件的名字规则和名字为：
	# ${spring.application.name}-${spring.profiles.active}.${file-extension}
	# nacos-config-client-dev.yaml
	# 微服务名称-当前环境-文件格式

> 若以上面的配置文件为例那么生成的dataId应为 ：nacos-config-client-dev.yaml



## 下面演示下证明下nacos默认优先的情况

> 本地配置文件：
>
> ```yml
> spring:
>   profiles:
>     active: dev # 表示开发环境
> 
> myconfig:
>   info: sssss
> 
> config:
>   info: sss2ww
> ```
>
> nacos配置文件：![](hhttps://cdn.jsdelivr.net/gh/lbwdada/Mybolg_img/2023-03-03/nacos%E4%BD%9C%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BC%9A%E5%92%8C%E6%9C%AC%E5%9C%B0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%E5%86%B2%E7%AA%81%E5%90%97/image-20230303223719740.png)
>
>
> 在启动nacos配置的情况下去获取config.info和myconfig.info的值
>
> ![](https://cdn.jsdelivr.net/gh/lbwdada/Mybolg_img/2023-03-03/nacos%E4%BD%9C%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BC%9A%E5%92%8C%E6%9C%AC%E5%9C%B0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%E5%86%B2%E7%AA%81%E5%90%97/image-20230303225753859.png)
>
> ![](https://cdn.jsdelivr.net/gh/lbwdada/Mybolg_img/2023-03-03/nacos%E4%BD%9C%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BC%9A%E5%92%8C%E6%9C%AC%E5%9C%B0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%E5%86%B2%E7%AA%81%E5%90%97/image-20230303225650608.png)
>
