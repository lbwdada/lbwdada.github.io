---
title: Arthas热替换的使用
categories:
- java
- jvm
tags:
- 学习记录
---

Arthas是一款阿里的线上jvm监控工具，集成了jinfo，jstack，jmap等命令以及热替换等实用功能。(官网)[https://arthas.aliyun.com/doc/]
<!-- more -->

## 热替换实战演示

​首先启动一个项目，这里启动的是官方的测试用jar包MathGame：

```shell
curl -O https://arthas.aliyun.com/math-game.jar
java -jar math-game.jar
```

​所有的操作可以在服务器上完成：

​1.使用jad命令对目标类进行反编译

```shell
  jad demo.MathGame  #jad后面跟的是class文件中package后的名称
  jad --source-only demo.MathGame > MathGame.java #使用--source-only只反编译源码，不带类加载器等其他信息
  #使用jad之后会在math-game.jar目录下生成对应类的.java文件
```

​2.编辑反编译的文件

![](https://cdn.jsdelivr.net/gh/lbwdada/Mybolg_img/2023-02-20/Arthas%E7%83%AD%E6%9B%BF%E6%8D%A2%E7%9A%84%E4%BD%BF%E7%94%A8/Image.png)

​3.sc 查找类加载器hash值

![](https://cdn.jsdelivr.net/gh/lbwdada/Mybolg_img/2023-02-20/Arthas%E7%83%AD%E6%9B%BF%E6%8D%A2%E7%9A%84%E4%BD%BF%E7%94%A8/sc.png)	

​4.mc（Memory Compiler/内存编译器）内存编译

```shell
mc -c 70dea4e /root/java-workspace/MathGame.java -d /root/java-workspace/
```

![](https://raw.githubusercontent.com/lbwdada/Mybolg_img/main/2023-02-20/Arthas%E7%83%AD%E6%9B%BF%E6%8D%A2%E7%9A%84%E4%BD%BF%E7%94%A8/mc.png)

​5.redefine 热更新代码

![](https://raw.githubusercontent.com/lbwdada/Mybolg_img/main/2023-02-20/Arthas%E7%83%AD%E6%9B%BF%E6%8D%A2%E7%9A%84%E4%BD%BF%E7%94%A8/redefine1.png)

![](https://raw.githubusercontent.com/lbwdada/Mybolg_img/main/2023-02-20/Arthas%E7%83%AD%E6%9B%BF%E6%8D%A2%E7%9A%84%E4%BD%BF%E7%94%A8/redefine2.png)
