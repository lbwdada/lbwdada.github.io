---
title: 将线性结构的数据转换成树形结构
categories:
- java
- JavaScript
tags:
- 工作记录
---

工作中遇到一个需求：某种分类其bean结构如下：MyBean{id,parentId,name,number}在添加时会选择上级，即parentId，所有的数据都是线性存储在MySQL中的现在因为前端使用了el-tree来展示树形数据，所以要在后台查询出数据列表之后将列表转换成树形结构，为了方便前台展示现修改实体类添加List<MyBean> children,parentName字段。

<!--  more  -->

## 1.在从数据库中查出数据后进行children的填充

```java
/**
     * 将线性的树形节点列表转换为树形结构
     * @param nodes 线性的树形节点列表
     * @return 树形结构
     */
    private List<MyBean> buildTree(List<MyBean> nodes) {
        // 根节点开始
        List<MyBean> roots = new ArrayList<>();
        for (MyBean node : nodes) {
            //首先确定根节点
            if (node.getParent() == null) {
                //然后为这个根节点添加children节点
                roots.add(addChildren(node, nodes));
            }
        }
        return roots;
    }

/**
     * 递归添加子节点
     * @param parent 父节点
     * @param nodes 所有节点
     * @return 父节点及其子节点构成的树
     */
    private  MyBean addChildren(MyBean parent, List<MyBean> nodes) {
        //为parent节点添加children节点，并为children节点赋值parentName
        for (MyBean node : nodes) {
            //当前节点的上级节点为parent
            if (node.getParent() != null && node.getParent().equals(parent.getId())) {
                //将当前节点添加至parent的children中，但要先递归找到当前节点的children
                MyBean child = addChildren(node, nodes);
                child.setParentName(parent.getMaterialName());
                parent.getChildren().add(child);
            }
        }
        //其子孙节点均已添加至parent中
        return parent;
    }


```

## 2.前端进行解析展示

> 前端有两种展示形式，第一种是使用el-table，第二种是el-tree。这两种组件都可以用来展示树形数据效果图如下：
>
> 第一种：![](https://cdn.jsdelivr.net/gh/lbwdada/Mybolg_img/2023-05-23/%E5%B0%86%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84%E7%9A%84%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2%E6%88%90%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84image-20230523112053435.png)
>
> 用来展示数据列表
>
> 第二种：![](hhttps://cdn.jsdelivr.net/gh/lbwdada/Mybolg_img/2023-05-23/%E5%B0%86%E7%BA%BF%E6%80%A7%E7%BB%93%E6%9E%84%E7%9A%84%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2%E6%88%90%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84image-20230523112118429.png)
>
> 用来添加上级时进行选择

### 2.1 el-table

  使用el-table展示树形数据需要添加:tree-props="{children: 'children', hasChildren: 'hasChildren'}"属性，该属性指定了tableData中的每个节点的children列表名称(children)和该节点是否有子节点(hasChildren，一个Boolean值有为true没有为false,但是添加这个字段之后table显示反而出问题？)。

### 2.2 el-tree(封装成组件)

  使用el-tree展示数据添加:props="{children: 'children',label: 'name'}"属性，该属性指定了数据中每个节点的children列表名称(children)和要展示的label数据(展示name字段的值)。

  在使用el-tree进行展示的时候还有这样一个需求：需要将选择好的名称进行回显和默认选中效果。解决方案是这样的：在组件中每次创建时会拿到后台封装好的树形结构数据进行展示，在拿到数据之后只需要用组件中传过来的选中的值进行搜索即可。

```javascript
doGetNameViewByNo(no, list) {
    for (let i = 0; i < list.length; i++) {
        let item = list[i];
        if (item.materialNo === no) {
            // 如果找到了目标节点，则直接返回节点名称
            this.selected = item.id;
            return item.materialName;
        }
        if (item.children && item.children.length > 0) {
            let result = this.doGetNameViewByNo(no, item.children);
            // 如果在子节点中找到了目标节点，则直接返回节点名称
            if (result) {
                return result;
            }
        }
    }
    // 如果没找到目标节点，则返回空字符串
    return "";
},
```