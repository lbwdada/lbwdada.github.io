---
title: vue使用全局缓存和使用全局组件
categories:
- JavaScript
- vue
tags:
- 工作记录
- 瞎折腾
- vuex
- 路由守卫
- 全局组件
---

  工作中遇到了一个很烦人的情况就是前端展示信息的时候有很多都是展示的关联的id，并没有展示出人能看懂的东西，比如用户昵称和小组名称等信息。于是针对这些问题我想到了用vue的全局缓存和自定义一个全局组件用来根据id展示这些名称，后面只要是碰到上面这种情况只需要将id传到组件中即可。当然感觉这个方法还是有些问题的，比如安全性方面等等；以后肯定还会学到更好的方法吧(￣▽￣)"......这里先把这种方法记录下来。
  
<!-- more -->

## 使用全局缓存

> 首先在store中添加对象，如用户昵称和id的列表...

```javascript
//代码示例 user.js
const user = {
  state: {
    userIdNameList: null,
    teamIdNameList: null
  },

  mutations: {
    SET_USER_ID_NAME_LIST: (state, list) =>{
      state.userIdNameList = list
    },
    SET_TEAM_ID_NAME_LIST: (state, list) =>{
      state.teamIdNameList = list
    }
  },

  actions: {
    //获取全部用户id username列表
    getAllUserIdName({commit}) {
      return new Promise((resolve, reject) =>{
        listIdName().then(res => {
          if (res.code === 200){
            commit('SET_USER_ID_NAME_LIST',res.data)
          }
          resolve()
        }).catch(error => {
          reject(error)
        })
      })
    },
    //获取全部班组id name 列表
    getAllTeamIdName({commit}){
      return new Promise((resolve, reject) =>{
        listAllIdNameNoPage().then(res => {
          if (res.code === 200){
            commit('SET_TEAM_ID_NAME_LIST',res.data)
          }
          resolve()
        }).catch(error => {
          reject(error)
        })
      })
    }
  }
}
```

```javascript
//getter.js
userIdNameList: state=> state.user.userIdNameList,
teamIdNameList: state=> state.user.teamIdNameList,
```

## 向缓存中填充数据

> 定义好store的存储对象之后就要考虑怎么在一开始时或者说应用创建时去获取对应的数据，在阅读了项目代码之后发现有一个permission.js的文件看名字应该是做权限的，其中定义了一个前置路由守卫，在其中为user.js中的其他对象进行了填充，索性我也添加在这里吧...

```javascript
//代码示例 permission.js
router.beforeEach((to, from, next) => {
 //.......
        if(store.getters.userIdNameList == null){
          //拉取用户id和名称列表
          store.dispatch('getAllUserIdName').then(() => {
            next()
          })
        }
        if(store.getters.teamIdNameList == null){
          //拉取班组id和名称列表
          store.dispatch('getAllTeamIdName').then(() => {
            next()
          })
        }
        next()
        //.........
})
```

## 创建全局组件并在里面使用缓存

> 直接上代码示例

```vue
<template>
    <span>{{nameView}}</span>
</template>

<script>
    import {parseStrEmpty} from "@/utils/inspur";
    import {listIdName} from '@/api/system/user'
    import store from "../../store";

    export default {
        name: "getNameView",
        props: {
            userIdProp: {
                type: String,
                default: null
            },
            userIdListProp: {
                type: String,
                default: null
            },
            teamIdListProp: {
                type: String,
                default: null
            }
        },
        data() {
            return {
                nameView: "--",
            }
        },
        created() {
            this.showName();
        },
        computed: {},
        mounted() {
        },
        methods: {
            showName() {
                if (this.userIdProp != null){
                    this.nameView = this.$store.getters.userIdNameList[this.userIdProp]
                }
                if (this.teamIdListProp != null){
                    let msg = '';
                    let tmp = JSON.parse(this.teamIdListProp);
                    for (let i = 0;i<tmp.length;i++){
                        msg += this.$store.getters.teamIdNameList[tmp[i]]
                    }
                    this.nameView = msg
                }
                if (this.userIdListProp != null){
                    let msg = "";
                    let tmpArr = this.userIdListProp.split(",");
                    for (let i = 0; i < tmpArr.length; i++) {
                        msg += " "+this.$store.getters.userIdNameList[Number(tmpArr[i])]
                    }
                    this.nameView = msg;
                }
            }
        },
        watch: {
            userIdProp: {
                handler(newValue, oldValue) {
                    if (newValue !== oldValue) {
                        this.showName()
                    }
                }
            },
          userIdListProp: {
            handler(newValue, oldValue) {
              if (newValue !== oldValue) {
                this.showName()
              }
            }
          }
        }
    }
</script>

<style scoped>

</style>
```
